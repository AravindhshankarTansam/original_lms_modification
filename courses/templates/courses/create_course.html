{% extends "accounts/admin/base.html" %}
{% load static %}

{% block content %}
<link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
<link rel="shortcut icon" href="{% static 'favicon.ico' %}" type="image/x-icon">

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />

<div class="container-fluid">
    <script id="courses-data" type="application/json">{{ courses_json|safe }}</script>

    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4 page-header">
        <h1 class="m-0">Create / Edit Course</h1>
        <a href="{% url 'course_table' %}" class="btn btn-secondary fw-semibold">‚Üê Back to Courses</a>
    </div>

    <form id="courseForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" id="courseId" name="course_id">
        <input type="hidden" id="modulesJson" name="modules_json">

        <!-- üîπ COURSE DETAILS (2x2 Layout) -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white fw-semibold">Course Details</div>
            <div class="card-body">
                <div class="course-grid-2x2">
                    <!-- Course Title -->
                    <div class="form-group">
                        <label class="form-label fw-semibold">Course Title</label>
                        <input type="text" class="form-control" id="courseTitle" name="title" required>
                    </div>

                    <!-- Course Image -->
                    <div class="form-group">
                        <label class="form-label fw-semibold">Course Image</label>
                        <input type="file" class="form-control" id="courseImage" name="image" accept=".jpg,.jpeg,.png">
                        <small class="text-muted d-block mt-1">Only JPG, JPEG, PNG formats allowed.</small>
                        <div class="mt-2">
                            <img id="imagePreview" src="" alt="Course Image Preview" class="img-thumbnail d-none" style="max-width: 300px;">
                            <div id="existingImageLink" class="mt-2"></div>
                        </div>
                    </div>

                    <!-- Course Description -->
                    <div class="form-group">
                        <label class="form-label fw-semibold">Course Description</label>
                        <div id="courseDescriptionEditor" class="quill-editor"></div>
                    </div>

                    <!-- Overview -->
                    <div class="form-group">
                        <label class="form-label fw-semibold">Overview</label>
                        <div id="overviewEditor" class="quill-editor"></div>
                    </div>

                    <!-- Requirements (Full Width) -->
                    <div class="form-group full-width">
                        <label class="form-label fw-semibold">Requirements</label>
                        <div id="requirementsEditor" class="quill-editor"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- üîπ MODULES SECTION (Dynamic 2x2 Layout) -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-secondary text-white fw-semibold d-flex justify-content-between align-items-center">
                Modules
                <button type="button" id="addModuleBtn" class="btn btn-light btn-sm fw-semibold">+ Add Module</button>
            </div>
            <div class="card-body" id="modulesContainer">
                <!-- Modules dynamically added here via JS -->
            </div>
        </div>

        <!-- üîπ STATUS + ACTIONS -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="courseStatus" checked>
                <label class="form-check-label fw-semibold ms-2" for="courseStatus">Active</label>
            </div>
            <button type="button" id="saveCourseBtn" class="btn btn-success fw-semibold">Save Course</button>
        </div>

        <div class="text-end mt-3">
            <button type="button" id="downloadCourseBtn" class="btn btn-danger fw-semibold">
                Download Course PDF
            </button>
        </div>
    </form>
</div>

<!-- ‚ú® STYLES (unchanged) -->
<style>
/* ... your CSS from earlier ... (kept exactly the same) ... */
.page-header { background: #f8f9fa; padding: 1rem 1.5rem; border-radius: 8px; border: 1px solid #e3e3e3; }
.card { border: none; border-radius: 10px; overflow: hidden; }
.card-header { font-size: 1.1rem; letter-spacing: 0.3px; }
.card-body { padding: 2rem; background: #fff; }
.course-grid-2x2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem 2rem; }
.course-grid-2x2 .form-group { display: flex; flex-direction: column; }
.course-grid-2x2 .form-group.full-width { grid-column: 1 / 3; }
#modulesContainer { background: #fafafa; padding: 1rem; border-radius: 8px; border: 1px dashed #ddd; }
.module-block { background: #fff; border: 1px solid #ddd; border-radius: 10px; padding: 1.5rem; margin-bottom: 1.5rem; }
.module-grid-2x2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem 2rem; }
.module-grid-2x2 .form-group { display: flex; flex-direction: column; }
.module-grid-2x2 .form-group.full-width { grid-column: 1 / 3; }
.form-control { border-radius: 6px; padding: 0.6rem 0.9rem; border: 1px solid #ccc; }
.form-label { margin-bottom: 0.5rem; }
.quill-editor { height: 150px; border: 1px solid #ced4da; border-radius: 6px; background: #fff; }
.btn { border-radius: 6px; padding: 0.5rem 1.2rem; }
.btn-success { background-color: #28a745; border: none; }
.btn-danger { background-color: #dc3545; border: none; }
.btn-secondary { background-color: #6c757d; border: none; }
.btn-outline-danger { border: 1px solid #dc3545; color: #dc3545; }
.img-thumbnail { border-radius: 6px; margin-top: 0.5rem; }
@media (max-width: 768px) { .course-grid-2x2, .module-grid-2x2 { grid-template-columns: 1fr; } }
.bg-light, .bg-white { border: 1px solid #dee2e6; }
</style>

<!-- JS Libraries -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="{% static 'js/create_courses.js' %}"></script>

{% endblock %}
