{% extends "accounts/admin/base.html" %}
{% load static %}

{% block content %}
<link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
<link rel="shortcut icon" href="{% static 'favicon.ico' %}" type="image/x-icon">

<div class="container-fluid">
    <script id="courses-data" type="application/json">{{ courses_json|safe }}</script>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="m-0">Create / Edit Course</h1>
        <a href="{% url 'course_table' %}" class="btn btn-secondary fw-semibold">‚Üê Back to Courses</a>
    </div>

    <div class="card">
        <div class="card-body">
            <form id="courseForm" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" id="courseId" name="course_id">
                <input type="hidden" id="modulesJson" name="modules_json">

                <!-- COURSE DETAILS -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-primary text-white fw-semibold">Course Details</div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Course Title</label>
                            <input type="text" class="form-control" id="courseTitle" name="title" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Course Description</label>
                            <div id="courseDescriptionEditor" class="quill-editor"></div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Course Image</label>
                            <input type="file" class="form-control" id="courseImage" name="image" accept=".jpg,.jpeg,.png">
                            <small class="text-muted">Only JPG, JPEG, PNG formats allowed.</small>

                            <div class="mt-3">
                                <img id="imagePreview" src="" alt="Course Image Preview" class="img-thumbnail d-none" style="max-width: 300px; height: auto;">
                                <div id="existingImageLink" class="mt-2"></div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Overview</label>
                            <div id="overviewEditor" class="quill-editor"></div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Requirements</label>
                            <div id="requirementsEditor" class="quill-editor"></div>
                        </div>
                    </div>
                </div>

                <!-- MODULES -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-secondary text-white fw-semibold d-flex justify-content-between align-items-center">
                        Modules
                        <button type="button" id="addModuleBtn" class="btn btn-light btn-sm fw-semibold">+ Add Module</button>
                    </div>
                    <div class="card-body" id="modulesContainer"></div>
                </div>

                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="courseStatus" checked>
                        <label class="form-check-label fw-semibold ms-2" for="courseStatus">Active</label>
                    </div>
                    <button type="button" id="saveCourseBtn" class="btn btn-success fw-semibold">Save Course</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.quill-editor { height: 150px; }
.bg-light, .bg-white { border: 1px solid #dee2e6; }
</style>

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script src="{% static 'js/create_courses.js' %}"></script>

{% endblock %}
