{% extends "accounts/admin/base.html" %}
{% load static %}

{% block content %}
<link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
<link rel="shortcut icon" href="{% static 'favicon.ico' %}" type="image/x-icon">
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<link href="{% static 'css/create_course.css' %}" rel="stylesheet" />

<div class="container-fluid">
    <script id="courses-data" type="application/json">{{ courses_json|safe }}</script>

    <!-- Page Header -->
    <div class="mb-4 page-header">
        <h1 class="m-0">Create / Edit Course</h1>
    </div>

    <form id="courseForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" id="courseId" name="course_id">
        <input type="hidden" id="modulesJson" name="modules_json">

        <!-- üîπ COURSE DETAILS -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white fw-semibold">Course Details</div>
            <div class="card-body">
                <div class="course-grid-2x2">
                    <!-- Course Category -->
                    <div class="form-group">
                        <label class="form-label fw-semibold" for="category">Course Category</label>
                        <select class="form-control" id="category" name="category" multiple required>
                            <option value="">Select Category</option>
                           {% for cat in categories %}
        <option value="{{ cat.id }}"
            {% if cat.id|stringformat:"s" in selected_categories %}selected{% endif %}>
            {{ cat.name }}
        </option>
    {% endfor %}
                        </select>
                    </div>

                    <!-- Course Title -->
                    <div class="form-group">
                        <label class="form-label fw-semibold">Course Title</label>
                        <input type="text" class="form-control" id="courseTitle" name="title" required>
                    </div>

                    <!-- Course Image -->
                    <div class="form-group">
                        <label class="form-label fw-semibold">Course Image</label>
                        <input type="file" class="form-control" id="courseImage" name="image" accept=".jpg,.jpeg,.png">
                        <small class="text-muted d-block mt-1">Only JPG, JPEG, PNG formats allowed.</small>
                        <div class="mt-2">
                            <img id="imagePreview" src="" alt="Course Image Preview" class="img-thumbnail d-none">
                            <div id="existingImageLink" class="mt-2"></div>
                        </div>
                    </div>

                    <!-- Course Description -->
                    <div class="form-group">
                        <label class="form-label fw-semibold">Course Description</label>
                        <div id="courseDescriptionEditor" class="quill-editor"></div>
                    </div>

                    <!-- Overview -->
                    <div class="form-group">
                        <label class="form-label fw-semibold">Overview</label>
                        <div id="overviewEditor" class="quill-editor"></div>
                    </div>

                    <!-- Requirements (Full Width) -->
                    <div class="form-group full-width">
                        <label class="form-label fw-semibold">Requirements</label>
                        <div id="requirementsEditor" class="quill-editor"></div>
                    </div>
                </div>

                <!-- üîπ COURSE METADATA -->
                <div class="course-metadata mt-3 border-top pt-3 d-flex flex-wrap gap-3">
                    <span><strong>Total Hours:</strong> <span id="totalHours">0</span> hrs</span>
                    <span><strong>Lectures:</strong> <span id="lecturesCount">0</span></span>
                    <span>
                        <strong>Level:</strong>
                        <select id="courseLevel" name="level" class="form-select form-select-sm d-inline-block" style="width:auto;">
                            <option value="Beginner">Beginner</option>
                            <option value="Intermediate">Intermediate</option>
                            <option value="Advanced">Advanced</option>
                        </select>
                    </span>
                    <span><strong>Rating:</strong> <span id="courseRating">0</span> ‚≠ê (<span id="reviewCount">0</span>)</span>
                    <span><strong>Badge:</strong> <span id="courseBadge">-</span></span>
                    <span><strong>Last Updated:</strong> <span id="lastUpdated">-</span></span>
                </div>
            </div>
        </div>

        <!-- üîπ MODULES SECTION -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-secondary text-white fw-semibold d-flex justify-content-between align-items-center">
                Modules
                <button type="button" id="addModuleBtn" class="btn btn-light btn-sm fw-semibold">+ Add Module</button>
            </div>
            <div class="card-body" id="modulesContainer">
                <!-- Modules dynamically injected via JS -->
            </div>
        </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
                <!-- Left: Back Button -->
                <a href="{% url 'course_table' %}" class="btn btn-secondary fw-semibold">‚Üê Back to Courses</a>

                <!-- Right: Status + Save + Download -->
                <div class="d-flex align-items-center gap-2">
                    <!-- Status Switch -->
                    <div class="form-check form-switch me-2">
                        <input class="form-check-input" type="checkbox" id="courseStatus" checked>
                        <label class="form-check-label fw-semibold ms-2" for="courseStatus">Active</label>
                    </div>

                    <!-- Save Course -->
                    <button type="button" id="saveCourseBtn" class="btn btn-success fw-semibold">Save Course</button>

                    <!-- Download PDF -->
                    <button type="button" id="downloadCourseBtn" class="btn btn-danger fw-semibold">Download Course PDF</button>
                </div>
            </div>

    </form>
</div>

<!-- JS Libraries -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="{% static 'js/create_courses.js' %}"></script>



{% endblock %}
